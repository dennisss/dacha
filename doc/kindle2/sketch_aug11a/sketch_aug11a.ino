
#include <Wire.h>

void setup() {
//  pinMode(20, INPUT);
//  pinMode(21, INPUT_PULLUP);
//  attachInterrupt(digitalPinToInterrupt(21), blink, RISING);
  Wire.begin(0x55);                // join i2c bus with address #8
  Wire.onRequest(requestEvent);
  Wire.onReceive(receiveEvent); // register event
  Serial.begin(9600);           // start serial for output
}

void loop() {
  delay(1000);
  Serial.println("Nothing");
}

void blink() {
  int v = digitalRead(20);
  Serial.println(v);
}

int state = 0;

#define RX_ELMNTS   128 
unsigned char I2C_Array[RX_ELMNTS] =
{0x00,0x40,0xb6,0x17,0x26,0x00,0xa1,0x04,0x75,0x0f,0x04,0x63,0xb7,0x0f,
0xd8,0x0f,0xb7,0x0f,0xd8,0x0f,0x67,0x00,0x27,0x09,0xff,0xff,0x67,0x00,0x27,
0x09,0x00,0x00,0x35,0x0e,0x0f,0x00,0x0f,0x00,0x82,0x08,0x02,0x00,0x0c,0x00,
0x63,0xe0,0xa0,0x07,0x21,0x00,0xf8,0x9b,0xc3,0x1b,0xff,0xff,0xa8,0xf6,0xff,0x00,
0xe3,0x03,0x4b,0x4e,0x00,0x00,0x05,0x00,0x00,0x00,0x21,0xa9,0xc7,0x48,0x38,0x85,
0x7f,0x66,0x6c,0x46,0xdf,0x20,0x36,0x09,0x00,0x01,0x52,0xa4,0xcf,0x0f,0x3f,0x24,
0x00,0x00,0x71,0xff,0x91,0xff,0x62,0xff,0x8d,0x04,0xd9,0x05,0x00,0x00,0x00,0x01,
0x00,0x07,0x00,0x00,0x2d,0x78,0x37,0x6d,0x7a,0xbb,0x21,0xa9,0xc7,0x48,0x38,0x85,
0x7f,0x66,0x00,0xa9};

void requestEvent(int howMany) {
  Serial.print("onRequest ");
  Serial.println(howMany);

  if (state >= 128) {
    Wire.write(0);
  } else {
    Wire.write(I2C_Array[state]);
  }

//  if (state == 126) {
//    Wire.write(0x00);
//  } else if (state == 6) {
//    Wire.write(0xff);
//  } else if (state == 7) {
//    Wire.write(0x04);
//  } else {
//    Wire.write(0xff);
//  }
  
//  while (Wire.available() > 0) { // loop through all but the last
//    int c = Wire.read(); // receive byte as a character
//    Serial.println(c);         // print the character
//  }
}

// function that executes whenever data is received from master
// this function is registered as an event, see setup()
void receiveEvent(int howMany) {
  Serial.print("onReceive ");
  Serial.println(howMany);
  while (Wire.available() > 0) { // loop through all but the last
    int c = Wire.read(); // receive byte as a character
    state = c;
    Serial.println(c);         // print the character
  }
//  int x = Wire.read();    // receive byte as an integer
//  Serial.println(x);         // print the integer
}
